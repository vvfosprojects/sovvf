<div *ngIf="filtri" class="border card-shadow rounded mt-1 mb-2 px-2 font-comp-xl" [ngClass]="nightModeBg()"
     [class.font-comp-xl]="viewState.composizione.active">
    <div class="row">
        <!-- Tasti Composizione Partenza -->
        <div *ngIf="composizionePartenza" class="col-1 py-1 pr-0">
            <div class="clearfix">
                <div class="float-left">
                    <button class="btn btn-block btn-danger btn-no-hover font-xlarge mr-2"
                            style="width: 65px"
                            ngbTooltip="Esci dalla Composizione Partenza"
                            placement="bottom-left"
                            (click)="turnOffComposizione()">
                        <i class="fa fa-arrow-left font-comp-xl"></i>
                    </button>
                </div>
                <div class="float-left"
                     (click)="$event.stopPropagation()">
                    <div class="d-inline-block" ngbDropdown #dropdownActionsMezzo="ngbDropdown"
                         (click)="$event.stopPropagation()">
                        <button id="dropdownActionsMezzo"
                                class="btn btn-info btn-no-hover font-xlarge"
                                ngbDropdownAnchor
                                ngbTooltip="Opzioni"
                                placement="bottom-left"
                                (click)="dropdownActionsMezzo.toggle(); $event.stopPropagation()">
                            <i class="fa fa-ellipsis-v font-comp-xl"></i>
                        </button>
                        <div ngbDropdownMenu>
                            <div ngbDropdownItem>
                                <app-tasto-comp-partenza (cambioModalita)="compPartenzaSwitch($event)"
                                                         [compPartenzaMode]="(composizioneMode$ | async)"
                                                         [disableTasto]="disableComposizioneMode">
                                </app-tasto-comp-partenza>
                            </div>
                            <div ngbDropdownItem>
                                <button class="btn btn-block btn-no-hover"
                                        [ngbTooltip]="tooltipPrenota"
                                        [disabled]="disableComposizioneMode"
                                        (click)="_confirmPrenota()">
                                    <i class="fa fa-hand-paper-o mr-1"></i>
                                    <span *ngIf="!prenotato">
                                        Prenota
                                    </span>
                                    <span *ngIf="prenotato" class="font-weight-bolder">
                                        Prenotata
                                    </span>
                                    <ng-template #tooltipPrenota>
                                        <span *ngIf="!prenotato">Voglio prenderla in carico</span>
                                        <span *ngIf="prenotato">Annulla presa in carico</span>
                                    </ng-template>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="float-left pt-2"
                     (click)="$event.stopPropagation()">
                    <button class="btn btn-block btn-primary btn-no-hover font-weight-bolder"
                            ngbTooltip="Visualizza Dettaglio Triage"
                            placement="bottom-left"
                            (click)="openDettaglioTriage()">
                        {{ 'Triage' | uppercase }}
                    </button>
                </div>
            </div>
        </div>
        <!-- Select Filtri -->
        <div [class.col-9]="composizionePartenza"
             [class.align-self-center]="viewState.composizione.active"
             [class.col-12]="sostituzionePartenza">
            <div class="row pt-1 mt-2"
                 [class.pb-2]="sostituzionePartenza">
                <div class="col-3">
                    <ng-select class="align-self-center font-xlarge"
                               [items]="filtri?.turni"
                               [multiple]="false"
                               [closeOnSelect]="true"
                               [hideSelected]="true"
                               [searchable]="false"
                               [loading]="!filtri?.turni"
                               (change)="addFiltro($event, 'turno')"
                               (clear)="clearFiltri('turno')"
                               placeholder="Turno: Corrente">
                    </ng-select>
                </div>
                <div class="col-3">
                    <ng-select class="align-self-center font-xlarge"
                               [items]="filtri?.distaccamenti"
                               bindLabel="descDistaccamento"
                               bindValue="id"
                               [multiple]="false"
                               [closeOnSelect]="true"
                               [hideSelected]="true"
                               [notFoundText]="notFoundText"
                               [loading]="!filtri?.distaccamenti"
                               (change)="addFiltro($event, 'codiceDistaccamento')"
                               (clear)="clearFiltri('codiceDistaccamento')"
                               placeholder="Distaccamento: Competenza">
                    </ng-select>
                </div>

                <!-- OLD => [ngClass]="{'col-3': !composizionePartenza && sostituzionePartenza, 'col-3': composizionePartenza && !sostituzionePartenza}" -->
                <div class="col-3">
                    <ng-select class="align-self-center font-xlarge"
                               [items]="filtri?.generiMezzi"
                               bindLabel="descrizione"
                               bindValue="descrizione"
                               [multiple]="false"
                               [closeOnSelect]="true"
                               [hideSelected]="true"
                               [notFoundText]="notFoundText"
                               [loading]="!filtri?.generiMezzi"
                               (change)="addFiltro($event, 'tipoMezzo')"
                               (clear)="clearFiltri('tipoMezzo')"
                               placeholder="Genere Mezzo: Tutti">
                    </ng-select>
                </div>
                <div [ngClass]="{'col-4': !composizionePartenza && sostituzionePartenza, 'col-3': composizionePartenza && !sostituzionePartenza}">
                    <ng-select class="align-self-center font-xlarge"
                               [items]="filtri?.stati"
                               bindLabel="descrizione"
                               bindValue="codice"
                               [multiple]="false"
                               [closeOnSelect]="true"
                               [hideSelected]="true"
                               [notFoundText]="notFoundText"
                               [loading]="!filtri?.stati"
                               (change)="addFiltro($event, 'statoMezzo')"
                               (clear)="clearFiltri('statoMezzo')"
                               placeholder="Stato: Tutti">
                        <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                            <div><span class="fa fa-eercast mr-2"
                                       [ngClass]="_iconaStatiClass(item.descrizione)"></span>{{item.descrizione}}</div>
                        </ng-template>
                    </ng-select>
                </div>
            </div>
            <div class="row pt-1"
                 [class.pb-2]="sostituzionePartenza">
                <div class="col mb-2">
                    <div class="font-xxlarge" style="text-align-last: center;">
                        <app-competenza *ngFor="let c of competenze; let i = index"
                                        [competenza]="c" [i]="i" [compAvanzata]="true"></app-competenza>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-2 pl-0"
             [class.d-none]="sostituzionePartenza || !triageSummary">
            <ng-template [ngIf]="getNoteOperatoreTriage()">
                <div class="p-1">
                    <small class="font-weight-bolder">Note Operatore Triage</small>
                    <div class="scroll-y" style="max-height:60px">
                        <h6 *ngFor="let nota of getNoteOperatoreTriage(); let i = index">{{ i + 1 }}. {{ nota }}</h6>
                    </div>
                </div>
            </ng-template>
        </div>
    </div>
</div>
