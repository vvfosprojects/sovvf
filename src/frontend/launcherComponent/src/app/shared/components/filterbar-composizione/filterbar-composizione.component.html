<div *ngIf="filtri" class="border card-shadow rounded mt-1 mb-2 px-2 font-comp-xl" [ngClass]="nightModeBg()"
     [class.font-comp-xl]="viewState.composizione.active">
    <div class="row">
        <!-- Tasti Composizione Partenza -->
        <div *ngIf="composizionePartenza" class="col-1 py-1 pr-0">
            <div class="clearfix">
                <div class="float-left">
                    <button class="btn btn-block btn-primary btn-no-hover font-xlarge mr-2" style="width: 65px"
                            (click)="turnOffComposizione()" ngbTooltip="Torna Chiamate/Interventi" placement="bottom-left">
                        <i class="fa fa-arrow-left font-comp-xl"></i>
                    </button>
                </div>
                <div class="pl-1" style="display:flex;" (click)="$event.stopPropagation()">
                    <div class="d-inline-block" ngbDropdown #dropdownActionsMezzo="ngbDropdown"
                         (click)="$event.stopPropagation()">
                        <button class="btn btn-info btn-no-hover font-xlarge" id="dropdownActionsMezzo" ngbDropdownAnchor
                                ngbTooltip="Opzioni" placement="bottom-left"
                                (click)="dropdownActionsMezzo.toggle(); $event.stopPropagation()">
                            <i class="fa fa-ellipsis-v font-comp-xl"></i>
                        </button>
                        <div ngbDropdownMenu>
                            <div ngbDropdownItem>
                                <app-tasto-comp-partenza (cambioModalita)="compPartenzaSwitch($event)"
                                                         [compPartenzaMode]="(composizioneMode$ | async)"
                                                         [disableTasto]="disableComposizioneMode">
                                </app-tasto-comp-partenza>
                            </div>
                            <div ngbDropdownItem>
                                <button class="btn btn-block btn-no-hover" [ngbTooltip]="tooltipPrenota"
                                        (click)="_confirmPrenota()" [disabled]="disableComposizioneMode">
                                    <i class="fa fa-hand-paper-o mr-1"></i>
                                    <span *ngIf="!prenotato">
                                        Prenota
                                    </span>
                                    <span *ngIf="prenotato" class="font-weight-bolder">
                                        Prenotata
                                    </span>
                                    <ng-template #tooltipPrenota>
                                        <span *ngIf="!prenotato">Voglio prenderla in carico</span>
                                        <span *ngIf="prenotato">Annulla presa in carico</span>
                                    </ng-template>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Select Filtri -->
        <div [class.col-9]="composizionePartenza"
             [class.align-self-center]="viewState.composizione.active"
             [class.col-12]="sostituzionePartenza">
          <div class="row pt-1 mt-1"
               [class.pb-2]="sostituzionePartenza">
            <div class="col-3">
              <ng-select class="align-self-center font-xlarge custom"
                         [items]="filtri?.turni"
                         [multiple]="false"
                         [closeOnSelect]="true"
                         [hideSelected]="true"
                         [searchable]="false"
                         [loading]="!filtri?.turni"
                         (change)="addFiltro($event, 'turno')"
                         (clear)="clearFiltri('turno')"
                         placeholder="Turno: Corrente">
              </ng-select>
            </div>
            <div class="col-3">
              <ng-select class="align-self-center font-xlarge"
                         style="max-height: 45px; overflow: auto"
                         [items]="filtri?.generiMezzi"
                         bindLabel="descrizione"
                         bindValue="descrizione"
                         [multiple]="true"
                         [closeOnSelect]="true"
                         [hideSelected]="true"
                         [appendTo]="'body'"
                         [(ngModel)]="genereMezzoSelezionato"
                         [notFoundText]="notFoundText"
                         [loading]="!filtri?.generiMezzi"
                         (change)="addFiltro($event, 'tipoMezzo')"
                         placeholder="Genere Mezzo: Tutti">
              </ng-select>
            </div>
            <div [ngClass]="{'col-4': !composizionePartenza && sostituzionePartenza, 'col-3': composizionePartenza && !sostituzionePartenza}">
              <ng-select class="align-self-center font-xlarge custom"
                         [items]="filtri?.stati"
                         bindLabel="descrizione"
                         bindValue="codice"
                         [multiple]="false"
                         [closeOnSelect]="true"
                         [hideSelected]="true"
                         [notFoundText]="notFoundText"
                         [loading]="!filtri?.stati"
                         (change)="addFiltro($event, 'statoMezzo')"
                         (clear)="clearFiltri('statoMezzo')"
                         placeholder="Stato: Tutti">
                <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                  <div><span class="fa fa-eercast mr-2"
                             [ngClass]="_iconaStatiClass(item.descrizione)"></span>{{item.descrizione}}</div>
                </ng-template>
              </ng-select>
            </div>
          </div>

          <div class="row pt-1" style="font-size: xx-large"
               [class.pb-2]="sostituzionePartenza">
            <div class="col-7 mb-2" style="max-height: 75px; overflow: auto;">
                <ng-select class="align-self-center font-xlarge"
                           [items]="filtri?.distaccamenti"
                           bindLabel="descDistaccamento"
                           bindValue="id"
                           [multiple]="true"
                           [appendTo]="'body'"
                           [closeOnSelect]="true"
                           [hideSelected]="true"
                           [(ngModel)]="distaccamentiSelezionati"
                           [notFoundText]="notFoundText"
                           [loading]="!filtri?.distaccamenti"
                           (change)="addFiltro($event, 'codiceDistaccamento')"
                           placeholder="Distaccamento: Tutti">
                </ng-select>
            </div>
            <span class="d-inline-flex">
              <button class="btn btn-sm btn-primary mr-1 btn-no-hover" (click)="setDistaccamentiDefault()"
                      ngbTooltip="Imposta Distaccamenti di competenza" style="height: fit-content; margin-top: 5px">
                <i class="fa fa-filter"></i>
              </button>
              <div class="font-xxlarge" style="text-align-last: center;">
                <app-competenza *ngFor="let c of competenze; let i = index"
                                [competenza]="c" [i]="i" [compAvanzata]="true"></app-competenza>
              </div>
            </span>
          </div>
        </div>
        <!-- Elimina Filtri Attivi -->
        <!--
        <button class="btn btn-sm btn-danger btn-no-hover align-self-center font-comp-xl"
                (click)="resetFiltri()" style="width: 55px; margin-left: 100px"
                ngbTooltip="Elimina Filtri Attivi">
            <i class="fa fa-trash font-comp-xl"></i>
        </button>
        -->
        <!-- Altri Filtri -->
       <!--
        <ng-template [ngIf]="composizionePartenza">
            <a href="javascript:void(0)" class="align-self-center font-weight-bolder pl-3">
                Altri Filtri
                <i class="fa fa-chevron-down"></i>
            </a>
        </ng-template>
        -->
      <div class="col-2 d-none" [class.d-none]="sostituzionePartenza">
        <div class="card card-shadow border" style="height: 80px; margin: 5px;">
          <div class="col">
            <div>
<!--              <span class="font-xlarge">Soccorso Aereo</span>-->
              <i class="fa fa-signal"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
